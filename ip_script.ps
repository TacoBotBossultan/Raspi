# Replace with your Pi's MAC address (case-insensitive, any delimiter)
$targetMac = "b8:27:eb:12:34:56"

# Normalize MAC to PowerShell's matching format
$normalizedMac = $targetMac -replace "[:-]", "-"

Write-Host "Scanning local network for Raspberry Pi with MAC: $targetMac`n"

# Get local subnet prefix
$localIP = (Get-NetIPAddress -AddressFamily IPv4 `
             | Where-Object {$_.InterfaceAlias -notmatch "Loopback"} `
             | Where-Object {$_.IPAddress -notmatch "169.254.*"} `
             | Select-Object -First 1).IPAddress
$subnet = ($localIP -replace '\.\d+$','')

# Ping all IPs in the subnet to populate ARP cache
1..254 | ForEach-Object {
    Test-Connection -Count 1 -Quiet "$subnet.$_ " | Out-Null
}

# Search ARP table for the MAC
$arpTable = arp -a | Select-String $normalizedMac

if ($arpTable) {
    Write-Host "Found Raspberry Pi:"
    $arpTable | ForEach-Object {
        ($_ -split '\s+')[0,1] -join " -> "
    }
} else {
    Write-Host "No device with MAC $targetMac found on this subnet."
}
